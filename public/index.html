<!DOCTYPE html>
<html>
  <head>
<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>

    <script type="text/javascript" src="https://www.gstatic.com/firebasejs/live/3.1/firebase.js"></script>


    <title>LOCUS</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  

  </head>
  


  <body>
<pre id="test">
</pre>



    <div id="map"></div>
    <script>
//firebase stuff
var user = document.location.toString().substring(39,document.location.length);

var lati;
    var longi;
    var map;
    var directionsService;
    var directionsDisplay;
    var listOfObjects = [];
    var myLatLng;
    var marker;
    var markersList = [];

  const config = {
    apiKey: "AIzaSyCN7rik4ofjrupxD9QxYzUyKxKnPPV2j9A",
    authDomain: "tracker-152008.firebaseapp.com",
    databaseURL: "https://tracker-152008.firebaseio.com",
    storageBucket: "tracker-152008.appspot.com/"
  };
  firebase.initializeApp(config);
  //firebase.storage()

//const preObject = document.getElementById('object');

const dbRefObject = new Firebase("https://tracker-152008.firebaseio.com/coordinates");
//const dbRefObject1 = new Firebase("https://tracker-152008.firebaseio.com/coordinates");
  


//update markers
dbRefObject.on('value', function(snapshot) {
    
    listOfObjects = [];
    if(!!markersList)
    {
      removeMarker(markersList);
    }
    
    snapshot.forEach(function(childSnapshot) {
      //var childData = childSnapshot.val();

      var singleObj = {}
    singleObj[0] = childSnapshot.val().Name;
    singleObj[1] = childSnapshot.val().Info;
    singleObj[2] = parseFloat(childSnapshot.val().latitude);
    singleObj[3] = parseFloat(childSnapshot.val().longitude);
    singleObj[4] = childSnapshot.val().Phone;
    singleObj[5] = childSnapshot.val().Photo;
    singleObj[6] = childSnapshot.val().stars;
    singleObj[7] = String(childSnapshot.val().type);
    singleObj[8] = childSnapshot.val().id;

    listOfObjects.push(singleObj);

    });
    test.innerText = listOfObjects[2][0] + " | " + listOfObjects[2][1] + " | " + listOfObjects[2][2] + " | " + listOfObjects[2][3] + " | " + listOfObjects[2][4] + " | " + listOfObjects[2][5] + " | " + listOfObjects[2][6] + " | " + listOfObjects[2][7] + " | " + listOfObjects[2][8];

//drawMarkers(listOfObjects);

//moveMarker(markersList,listOfObjects);
markersList = drawMarkers(listOfObjects);

});

  //draw markers once
  dbRefObject.once('value', function(snapshot) {

  
     
    });

//dbRefObject.on('value', function(snapshot) {

 
//});


//map functions

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 31.5546, lng: 74.3572},
          zoom: 7
        });

      }


      //markers function
      function drawMarkers(list)
{
var infoWindow = new google.maps.InfoWindow(); 

var cabImage = 'https://firebasestorage.googleapis.com/v0/b/tracker-152008.appspot.com/o/Markers%2Flocus%20without%20shade-01.png?alt=media&token=2b601bf5-d256-4339-8d3c-feea40ff7ebf';
var rickImage = 'https://firebasestorage.googleapis.com/v0/b/tracker-152008.appspot.com/o/Markers%2Flocus%20-%20rickshaw-01.png?alt=media&token=60cdf289-2d6c-45cf-9ddf-df5023a8a685';
var bounds = new google.maps.LatLngBounds();
var markersList = [];


for(var i = 0; i < list.length; i++ ) {
		var cabType = list[i][7];
        var position = new google.maps.LatLng(list[i][2], list[i][3]);
        //bounds.extend(position);
        marker = new google.maps.Marker({
            position: position,
            icon: cabImage,
            map: map,
            title: list[i][0],

            //if (true) {icon: cabImage} //else{icon: rickImage}
            	
        });
        // Add info window to marker    
        /*google.maps.event.addListener(marker, 'click', (function(marker, i) {
            return function() {

                infoWindow.setContent('<div class="w3-container">'+
                '<div class="w3-card-12" style="width:200px" hight=100px">'+
                '<img src="img_fjords.jpg" alt="Norway" style="width:100%">'+
                '<div class="w3-container w3-center">'+
                '<p style="font-size:10px">STARS: </p>'+
                '<p style="font-size:10px">INFO:  </p>'+
                '<p style="font-size:10px">CONTACT: </p>'+
                '</div>'+
                '</div>'+
                '</div>');

                infoWindow.open(map, marker);
                //document.getElementById("para").textContent=list[i][5];
            }
        })(marker, i));*/
        

        
        markersList.push(marker);
        // Center the map to fit all markers on the screen
        //map.fitBounds(bounds);


    }
    return markersList;
}


function changeAttri()
{
	document.getElementById('test').innerText = "Zain Mohsin";
}


function removeMarker(marker) {
    var i;
    for(i=0; i<marker.length; i++){
        marker[i].setMap(null);
    }
};

function moveMarker(marker,list) {
    for(var i = 0; i < marker.length; i++ )
    {
    marker[0].setPosition( new google.maps.LatLng( list[i][2],list[i][3]) );
    //map.panTo( new google.maps.LatLng( list[i][2],list[i][3]) );
    }
};
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUd-hJtGy3ynUFIib3vQyagZ0GznInEoQ&callback=initMap"
    async defer></script>
  </body>
</html>